---
title: axiosëŠ” íŒŒë¼ë¯¸í„°ì— ëŒ€ê´„í˜¸ë¥¼ ì¸ì½”ë”©í•˜ì§€ ì•ŠëŠ”ë‹¤.
date: 'February 25, 2022 9:40 PM'
tags: ['Network']
draft: false
summary: 'axiosê°€ ê·¸ëŸ´ì¤„ì€ ëª°ëžì§€'
authors: []
---

- axios : v0.20.0

# ðŸ˜Â ë¬¸ì œ

ì„œë¹„ìŠ¤ ê°œë°œ ì¤‘ì— **ëŒ€ê´„í˜¸ë¥¼ í¬í•¨í•œ ê°’ì´ query valueì— ë“¤ì–´ê°€ë©´, ì—ëŸ¬ê°€ ë°œìƒ**í•˜ëŠ” ì´ìŠˆê°€ ìžˆì—ˆë‹¤.

## ë„¤íŠ¸ì›Œí¬ íƒ­ ì‚´íŽ´ë³´ê¸°

ê²€ìƒ‰ì°½ì— ëŒ€ê´„í˜¸ë¥¼ í¬í•¨í•œ ê°’ì„ ìž…ë ¥í•˜ê³ , API ìš”ì²­ê³¼ ì‘ë‹µê°’ì„ í™•ì¸í•˜ì˜€ë‹¤.

API ì‘ë‹µì„ ì‚´íŽ´ë³´ë©´, preflightì—ì„œëŠ” 400ì— CORS ì—ëŸ¬ê°€ ë‚¬ê³ , ë³¸ ìš”ì²­ì€ Network Errorê°€ ë°œìƒí•˜ê³  ìžˆì—ˆë‹¤.

- Preflight ìš”ì²­
    - CORS Error ë°œìƒ
    - production í™˜ê²½ì´ ì•„ë‹ˆë¼ì„œ ì„œë²„ì—ì„œëŠ” Access-Control-Allow-Originì„ ì „ì²´ ë‹¤ í—ˆìš©í•´ì¤€ ê²ƒìœ¼ë¡œ ì•Œê³  ìžˆëŠ”ë°, ì™œ CORS ì •ì±…ì— ì˜í•´ ë§‰ížŒ ê²ƒì¸ì§€ ìž˜ ëª¨ë¥´ê² ë‹¤. ~~ì§ìž‘í•˜ê¸°ë¡œëŠ” ì„œë²„ì—ì„œ originì„ ëŒ€ê´„í˜¸ ì•ˆì— ìžˆëŠ” 15ë¥¼ origin ìœ¼ë¡œ ë³´ì•„ì„œ ê·¸ëŸ° ê²ƒì¸ê°€ ì‹¶ë‹¤(ì•„ë‹ ê²ƒ ê°™ìŒ..).~~
    
    ![Sheep-Screenshot 2022-02-25 PM 9.45.41.png](/static/images/axios-does-not-encode-square-bracket/Sheep-Screenshot_2022-02-25_PM_9.45.41.png)
    
- ë³¸ ìš”ì²­
    - Network Error ë°œìƒ

## ì¸ì½”ë”© ë˜ì§€ ì•ŠëŠ” íŒŒë¼ë¯¸í„°

ì—¬ê¸°ì„œ ì´ìƒí•œ ì ì€ assetNameì˜ valueë¡œ ì „ì†¡ëœ "bm_ad15[15]"ê°€ **ì¸ì½”ë”©ì´ ë˜ì§€ ì•Šê³  ìš”ì²­ì´ ì „ì†¡ëœë‹¤ëŠ” ì **ì´ì—ˆë‹¤.

![Sheep-Screenshot 2022-02-25 PM 10.51.15.png](/static/images/axios-does-not-encode-square-bracket/Sheep-Screenshot_2022-02-25_PM_10.51.15.png)

URLì—ì„œ path ë’¤ì— ?ë¡œ ì‹œìž‘í•˜ê³  &ë¡œ ì—°ê²°ëœ key-value ìŒì„ `query string`ì´ë¼ê³  í•˜ê³ , ê°ê°ì˜ key=valueë¥¼ `parameter`ë¼ê³  í•œë‹¤.

- query strings
    - ?key1=value1&key2=value2
- parameter
    - key1=value1
    - key2=value2

axiosë¡œ ìš”ì²­ ì‹œ, request configì˜ paramsì— ì „ì†¡í•  íŒŒë¼ë¯¸í„°ë¥¼ ê°ì²´ í˜•íƒœë¡œ ì „ë‹¬í•˜ê²Œ ëœë‹¤.

```jsx
  // `params` are the URL parameters to be sent with the request
  // Must be a plain object or a URLSearchParams object
  params: {
    ID: 12345
  },
```

ì´ ë•Œ, ë”°ë¡œ serializerë¥¼ ì§€ì •í•˜ì§€ ì•Šë”ë¼ë„, paramsì— ë„£ì€ ê°ì²´ë“¤ì˜ key-valueëŠ” ì¸ì½”ë”©ì´ ë˜ì–´ì„œ ìš”ì²­ì´ ì „ì†¡ëœ

ì˜ˆë¥¼ ë“¤ì–´, ê²€ìƒ‰ì°½ì—Â `who&lillie=yang` ë¥¼ ê²€ìƒ‰í•œ í›„, ìš”ì²­ìœ¼ë¡œ ì „ì†¡ëœ urlì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì‚´íŽ´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¸ì½”ë”©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.

```
?assetType=AD_ACCOUNT&assetName=who%26lillie%3Dyang&size=30
```

ì‚¬ìš©ìžëŠ” `who&lillie=yang`ë¥¼ ê²€ìƒ‰í•˜ì˜€ì§€ë§Œ, ìš”ì²­ì´ ë³´ë‚´ì§€ê¸° ì „ì— `who%26lillie%3Dyang`ìœ¼ë¡œ ì¸ì½”ë”©ëœ ê°’ì´ ì „ì†¡ëœ ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤.

ì°¸ê³ ë¡œ, `UTF-8`ë¡œ ì¸ì½”ë”©ì´ ë˜ë©°, ì´ëŠ” `encodeURIComponent` í•¨ìˆ˜ì— ê°’ì„ ë„£ì–´ë³´ë©´, ì¸ì½”ë”©ëœ ê°’ì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.

```bash
> encodeURIComponent('who&lillie=yang')
'who%26lillie%3Dyang'
```

ì´ë ‡ê²Œ **ì¸ì½”ë”©í•´ì„œ ì „ì†¡í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ì‚¬ìš©ìžê°€ ìž…ë ¥í•œ ê°’ê³¼ URLì˜ ìš”ì†Œì˜ êµ¬ë¶„ìž(delimiter)ë¥¼ êµ¬ë³„í•´ì•¼í•˜ê¸° ë•Œë¬¸**ì´ë‹¤.

ë§Œì•½, ì¸ì½”ë”©í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì „ì†¡ì´ ë˜ì—ˆì„ ê²ƒì´ë‹¤.

ì´ íŒŒë¼ë¯¸í„°ë¥¼ ë¶„ì„í•˜ë©´, assetNameì— ëŒ€í•œ valueëŠ” whoê°€ ë˜ê³ , lillieë¼ëŠ” keyì— valueëŠ” yangì´ ëœë‹¤.

```
?assetType=AD_ACCOUNT&assetName=who&lillie=yang&size=30
```

ì´ë ‡ë“¯ ì˜ë„í•˜ì§€ ì•Šê²Œ íŒŒë¼ë¯¸í„°ê°€ í•´ì„ë˜ëŠ” ë¬¸ì œë¥¼ ë§‰ê¸° ìœ„í•´, íŒŒë¼ë¯¸í„°ë¥¼ ì¸ì½”ë”©í•´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.

ë‹¤ì‹œ ë¬¸ì œë¡œ ëŒì•„ì™€ì„œ...

`encodeURIComponent` í•¨ìˆ˜ëŠ” ì•„ëž˜ íŠ¹ìˆ˜ë¬¸ìžë¥¼ ì œì™¸í•œ ë¬¸ìžë¥¼ ì´ìŠ¤ì¼€ì´í”„í•œë‹¤ê³  í•œë‹¤.

```
A-Z a-z 0-9 - _ . ! ~ * ' ( )
```

ê·¸ë ‡ë‹¤ë©´ ëŒ€ê´„í˜¸ë„ ì•„ëž˜ì™€ ê°™ì´ ì¸ì½”ë”©ì´ ë˜ì–´ì•¼ í• í…ë°, axiosë¥¼ í†µí•´ ì „ì†¡ëœ ëŒ€ê´„í˜¸ëŠ” ì¸ì½”ë”©ì´ ë˜ì§€ ì•Šê³  ìžˆì—ˆë‹¤.

(ëŒ€ê´„í˜¸ê°€ ê·¼ë³¸ì ìœ¼ë¡œ ì¸ì½”ë”©ë˜ì–´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ì•„ëž˜ 'ìƒˆë¡­ê²Œ ì•Œê²Œëœ ì 'ì—ì„œ ë” ì¶”ê°€í•˜ì˜€ë‹¤.)

```bash
> encodeURIComponent('[]')
'%5B%5D'
```

# ðŸ”Â ì›ì¸

ì´ ì´ìŠˆëŠ” axiosì˜ ê¹ƒí—™ ì´ìŠˆì—ì„œë„ ì°¾ì•„ë³¼ ìˆ˜ ìžˆì—ˆë‹¤.

[https://github.com/axios/axios/issues/3316](https://github.com/axios/axios/issues/3316)

[https://github.com/axios/axios/issues/2510](https://github.com/axios/axios/issues/2510)

[axios ì½”ë“œ ë ˆë²¨](https://github.com/axios/axios/blob/master/lib/helpers/buildURL.js#L5)ì—ì„œ ì‚´íŽ´ë³´ë‹ˆ, encodeURIComponentë¡œ ì¸ì½”ë”©í•œ ë’¤, ì¸ì½”ë”©í•œ ê°’ì„ ë‹¤ì‹œ ì›ëž˜ì˜ ëŒ€ê´„í˜¸ë¡œ ë³€ê²½í•´ì£¼ê³  ìžˆì—ˆë‹¤.

```jsx
function encode(val) {
  return encodeURIComponent(val).
  replace(/%3A/gi, ':').
  replace(/%24/g, '$').
  replace(/%2C/gi, ',').
  replace(/%20/g, '+').
  replace(/%5B/gi, '[').
  replace(/%5D/gi, ']');
}
```

# ðŸ’‰í•´ê²°

ë‹¤ì‹œ axiosì˜ buildURL.jsë¥¼ ë³´ìž.

ì„¸ ë²ˆì§¸ ì¸ìžë¡œ `paramsSerializer`ë¥¼ ì „ë‹¬í•˜ê²Œ ëœë‹¤ë©´, encode í•¨ìˆ˜ë¡œ ì¸ì½”ë”©í•˜ì§€ ì•Šê³ , `paramsSerializer`ë¥¼ ê·¸ëƒ¥ í˜¸ì¶œí•´ì„œ serializeë¥¼ í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤.

```jsx
/**
 * Build a URL by appending params to the end
 *
 * @param {string} url The base of the url (e.g., http://www.google.com)
 * @param {object} [params] The params to be appended
 * @returns {string} The formatted url
 */
module.exports = function buildURL(url, params, paramsSerializer) {
  /*eslint no-param-reassign:0*/
  if (!params) {
    return url;
  }

  var serializedParams;
  if (paramsSerializer) {
    serializedParams = paramsSerializer(params);
  } else if (utils.isURLSearchParams(params)) {
    serializedParams = params.toString();
  } else {
...
  }
 Â ...
  return url;
}

```

[https://github.com/axios/axios/blob/master/lib/helpers/buildURL.js#L29](https://github.com/axios/axios/blob/master/lib/helpers/buildURL.js#L29)

ì„¸ ë²ˆì§¸ì— ë„£ì„ ìˆ˜ ìžˆëŠ” `paramsSerializer`ëŠ” axiosì˜ request config ê°ì²´ì—ì„œ ì§€ì •í•  ìˆ˜ ìžˆëŠ” ê°’ì´ë‹¤.

```jsx
  // `paramsSerializer` is an optional function in charge of serializing `params`
  // (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)
  paramsSerializer: function (params) {
    return Qs.stringify(params, {arrayFormat: 'brackets'})
  },
```

ë”°ë¼ì„œ, encodeURIComponentë¡œ query valueë¥¼ ì¸ì½”ë”©í•˜ëŠ” paramsSerializer í•¨ìˆ˜ë¥¼ ì§€ì •í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤.

```jsx

const config = {
  url,
  method,
  params,
  paramsSerializer (params) {
		return `${Object.entries(queryObject)
    .map(([queryName, queryValue]) => `${queryName}=${encodeURIComponent(queryValue ?? '')}`)
    .join('&')}`
  },
  data,
  ...options,
};
const api = createInstance();
api.request(config);
```

ë‹¤ì‹œ ëŒ€ê´„í˜¸ë¥¼ ë„£ì–´ì„œ ê²€ìƒ‰ì„ í•´ë³´ë©´, ëŒ€ê´„í˜¸ë„ ì¸ì½”ë”©ì´ ë˜ì—ˆê³ , ê·¸ ê²€ìƒ‰ì— ëŒ€í•œ ê²°ê³¼ ë˜í•œ ì œëŒ€ë¡œ ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆì—ˆë‹¤.

# ðŸ’¡ìƒˆë¡­ê²Œ ì•Œê²Œëœ ì 

## ëŒ€ê´„í˜¸ê°€ URIì˜ authority ì—ì„œëŠ” ì˜ˆì•½ì–´ì´ë‹¤.

ëŒ€ê´„í˜¸ëŠ” URIì—ì„œ ì˜ˆì•½ì–´ (reserved characters) ì˜€ë‹¤.

```jsx
reserved    = gen-delims / sub-delims

gen-delims  = ":" / "/" / "?" / "#" / "[" / "]" / "@"

sub-delims  = "!" / "$" / "&" / "'" / "(" / ")"
            / "*" / "+" / "," / ";" / "="
```

[URIì— ëŒ€í•œ RFC3986ì˜ 3.2.2 Host](https://datatracker.ietf.org/doc/html/rfc3986#section-3.2.2)ë¥¼ ë³´ë©´, ì´ëŸ° ì•ˆë‚´ê°€ ì í˜€ìžˆë‹¤.

> A host identified by an Internet Protocol literal address, version 6
   [RFC3513] or later, is distinguished by enclosing the IP literal
   within square brackets ("[" and "]").  This is the only place where
   square bracket characters are allowed in the URI syntax.
> 

í•´ì„í•´ë³´ë©´, URIì—ì„œ ìœ ì¼í•˜ê²Œ ëŒ€ê´„í˜¸ê°€ ìœ„ì¹˜í•  ìˆ˜ ìžˆëŠ” ê³³ì€ `Host` ì˜ì—­ì— `IP-literal` (IPv6ë‚˜ ê·¸ ì´ìƒì˜ ë²„ì „)ì´ ì˜¬ ë•Œ, IP-literalì˜ ë°”ê¹¥ì„ ê°ì‹¸ëŠ” ê³³ ë¿ì´ë¼ëŠ” ê²ƒì´ë‹¤.

![Sheep-Screenshot 2022-02-25 PM 10.57.39.png](/static/images/axios-does-not-encode-square-bracket/Sheep-Screenshot_2022-02-25_PM_10.57.39.png)

URIëŠ” scheme(protocol), authority, port, path, query, fragment ë¡œ êµ¬ì„±ë  ìˆ˜ ìžˆë‹¤. (ëª¨ë‘ í•„ìˆ˜ëŠ” ì•„ë‹ˆë‹¤.)

```
authority   = [ userinfo "@" ] host [ ":" port ]
```

ì—¬ê¸°ì„œ ìŠ¬ëž˜ì‰¬ ë‘ê°œ (//)ë¡œ ì‹œìž‘í•˜ëŠ” êµ¬ê°„ì´, `authority`ì´ê³ , ê·¸ ì•ˆì˜ êµ¬ì„±ìš”ì†Œì¸ `userinfo`ì™€ `port` ì‚¬ì´ì— ìžˆëŠ” ì»´í¬ë„ŒíŠ¸ê°€ `host`ì´ë‹¤.

ì´ hostì—ëŠ” í”ížˆ business.kakao.comê³¼ ê°™ì€ ë„ë©”ì¸ ë„¤ìž„ì´ ë“¤ì–´ê°€ì§€ë§Œ, ipì£¼ì†Œê°€ ë“¤ì–´ê°ˆ ìˆ˜ë„ ìžˆë‹¤.

hostì˜ ipv6 ì£¼ì†Œê°€ ë“¤ì–´ê°„ë‹¤ë©´, ë°˜ë“œì‹œ ì–‘ìª½ì„ ëŒ€ê´„í˜¸ë¡œ ê°ì‹¸ì£¼ì–´ì•¼ í•œë‹¤.

```
https://[2001:470:30:84:e276:63ff:fe72:3900]/blog/urls.html
```

**ðŸ‘‰Â  hostì—ì„œ IPv6ë¥¼ ê°ì‹¸ì£¼ëŠ” ê³³ì´ ì•„ë‹Œ ê³³ì— ëŒ€ê´„í˜¸ê°€ ë“¤ì–´ê°€ë©´ ì•ˆë˜ë¯€ë¡œ, queryì— ëŒ€ê´„í˜¸ë¥¼ ë„£ì–´ì£¼ê² ë‹¤ë©´ ë°˜ë“œì‹œ ì¸ì½”ë”©ì„ í•´ì£¼ì–´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.**

## axios 1.0.0ì„ ê¸°ëŒ€í•´ë³´ìž

axios 1.0.0-beta.1 ë¸Œëžœì¹˜ì—ì„œëŠ” ëŒ€ê´„í˜¸ë¥¼ ì¸ì½”ë”©í•´ì£¼ê³  ìžˆë‹¤.

1.0.0 ë²„ì „ì´ ë¦´ë¦¬ì¦ˆ ëœë‹¤ë©´, ë”ì´ìƒ ì´ ë¬¸ì œì— ëŒ€í•´ ê³ ë¯¼í•˜ì§€ ì•Šì•„ë„ ë  ìˆ˜ ìžˆì„ì§€ë„...?

[https://github.com/axios/axios/blob/release/1.0.0-beta.1/lib/helpers/buildURL.js#L5](https://github.com/axios/axios/blob/release/1.0.0-beta.1/lib/helpers/buildURL.js#L5)

# ðŸŒŠÂ ë” ê°œì„ í•œë‹¤ë©´ ?

## íŒŒë¼ë¯¸í„°ì˜ keyë„ ì¸ì½”ë”©í•˜ê¸°

axiosì˜ ì½”ë“œë¥¼ ë³´ë©´, íŒŒë¼ë¯¸í„°ì˜ keyë„ ì¸ì½”ë”©ì„ í•´ì£¼ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.

```javascript
parts.push(encode(key) + '=' + encode(v));
```

[https://github.com/axios/axios/blob/master/lib/helpers/buildURL.js#L53](https://github.com/axios/axios/blob/master/lib/helpers/buildURL.js#L53)

ì•žì„œì„œ, ì‚¬ìš©ìžê°€ ìž…ë ¥í•œ ê°’ê³¼ URIì˜ êµ¬ë¶„ìžë¥¼ êµ¬ë³„í•´ë‚´ê¸° ìœ„í•´ queryë¥¼ ì¸ì½”ë”©í•´ì£¼ì–´ì•¼ í•œë‹¤ê³  ë§í–ˆëŠ”ë°,

ì´ëŠ” íŒŒë¼ë¯¸í„°ì˜ keyì—ë„ í•´ë‹¹ë˜ëŠ” ì´ì•¼ê¸°ì˜€ë‹¤.

í˜„ìž¬ëŠ” íŒŒë¼ë¯¸í„°ì˜ keyì— URI êµ¬ë¶„ìžê°€ ë“¤ì–´ê°€ëŠ” ê²½ìš°ê°€ ì—†ì–´ì„œ ì¸ì½”ë”©ì„ í•´ì£¼ì§€ ì•Šì•„ë„ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

ê·¸ëŸ¬ë‚˜, ì¶”í›„ì—ëŠ” API ìŠ¤íŽ™ì´ ì–´ë–»ê²Œ ë ì§€ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, querystring ì— ì˜í•´ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìžˆëŠ” ë¶€ë¶„ì¸ ê²ƒ ê°™ë‹¤.

íŒŒë¼ë¯¸í„°ì˜ keyë¥¼ encodeURIComponentë¡œ ì¸ì½”ë”©í•´ì£¼ì–´ì„œ ë” ì•ˆì „í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìžˆì„ ê²ƒ ê°™ë‹¤.

```jsx
const config = {
  url,
  method,
  params,
  paramsSerializer (params) {
		return `${Object.entries(queryObject)
    .map(([queryName, queryValue]) => `${encodeURIComponent(queryName)}=${encodeURIComponent(queryValue ?? '')}`)
    .join('&')}`
  },
  data,
  ...options,
};
```

# ðŸ”—Â ì°¸ê³ 

- [https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_URL](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_URL)
- [https://doepud.co.uk/anatomy-of-a-url](https://doepud.co.uk/anatomy-of-a-url)
- [https://github.com/axios/axios/blob/master/lib/helpers/buildURL.js](https://github.com/axios/axios/blob/master/lib/helpers/buildURL.js)
- [https://www.netmeister.org/blog/urls.html](https://www.netmeister.org/blog/urls.html)
- [https://datatracker.ietf.org/doc/html/rfc3986#section-3.2.2](https://datatracker.ietf.org/doc/html/rfc3986#section-3.2.2)